import { addUser, updateUser, deleteUser, getUser } from "./dataStore";
import { UserData } from "./types";

async function testDatabase() {
  try {
    console.log("ğŸš€ Starting database test...");

    // 1ï¸âƒ£ Add user
    const newUser: UserData = {
        id: -1, // This may be auto-generated by the database
        nameFirst: "John",
        nameLast: "Smith",
        email: "javasmith@gmail.com",
        password: "example123",
        numSuccessfulLogins: 0,
        numFailedPasswordsSinceLastLogin: 0
    };
    newUser.id = await addUser(newUser);
    console.log("â• User added with id:", newUser.id);

    // 2ï¸âƒ£ Fetch and log the newly added user
    const fetchedUser = await getUser(newUser.id);
    console.log("ğŸ” Fetched User:", fetchedUser);

    // 3ï¸âƒ£ Update the user's details
    const updatedUser: UserData = { ...newUser, nameFirst: "Stacy", nameLast: "Mittens", email: "smitten@gmail.com" };
    const updatedResult = await updateUser(updatedUser);
    console.log("âœï¸  User updated?", updatedResult);

    // 4ï¸âƒ£ Fetch and log the updated user
    const fetchedUpdatedUser = await getUser(newUser.id);
    console.log("ğŸ” Updated User:", fetchedUpdatedUser);

    // 5ï¸âƒ£ Delete the user
    const deleteResult = await deleteUser(newUser.id);
    console.log("ğŸ—‘ï¸  User deleted?", deleteResult);

    // 6ï¸âƒ£ Try fetching deleted user (null)
    const deletedUser = await getUser(newUser.id);
    console.log("ğŸ” Deleted User (should be null):", deletedUser);

    console.log("âœ… Database test completed successfully!");
  } catch (error) {
    console.error("âŒ Error during database test:", error);
  }
}

// Run the test function
testDatabase();
